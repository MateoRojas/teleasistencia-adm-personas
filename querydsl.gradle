sourceSets {
    querydsl {
        java {
            srcDirs "src/querydsl/java"
        }
    }
}

sourceSets.main.java.srcDirs += "src/querydsl/java"
sourceSets.querydsl.java.srcDirs += 'src/querydsl/java'

configurations {
    querydslapt
}

task generateQueryDSL(type: JavaCompile, group: 'build', description: 'Generates the QueryDSL query types') {
    source = sourceSets.main.java
    classpath = configurations.compile + configurations.querydslapt
    options.compilerArgs = [
            "-proc:only",
            "-processor", "com.querydsl.apt.jpa.JPAAnnotationProcessor"
    ]
    destinationDir = sourceSets.querydsl.java.srcDirs.iterator().next()
}

compileJava {
    dependsOn generateQueryDSL
    source += sourceSets.querydsl.java.srcDirs
}

clean {
    delete sourceSets.querydsl.java.srcDirs
}
